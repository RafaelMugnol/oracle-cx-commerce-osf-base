/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

const {occServerSatisfiesMinVersion} = require('../index');

test('OCC Version Compare ignores prerelease tags', () => {
  expect(occServerSatisfiesMinVersion('20.1.0-SNAPSHOT', '20.1.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1-SNAPSHOT', '20.1.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1-SNAPSHOT-SNAPSHOT', '20.1.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.1.0-SNAPSHOT')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.1-SNAPSHOT')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.1-SNAPSHOT-SNAPSHOT')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.1-SNAPSHOT', '20.1.0-SNAPSHOT')).toBeTruthy();
});

test('OCC Version Compare fails on old versions', () => {
  expect(occServerSatisfiesMinVersion('20.1.0-SNAPSHOT', '20.2.0')).toBeFalsy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.1.1-SNAPSHOT')).toBeFalsy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.2.0')).toBeFalsy();
  expect(occServerSatisfiesMinVersion('20.1', '20.2.0')).toBeFalsy();
  expect(occServerSatisfiesMinVersion('20.1', '20.2')).toBeFalsy();
  expect(occServerSatisfiesMinVersion('20.1.0', '20.2')).toBeFalsy();
});

test('OCC Version Compare passes newer versions', () => {
  expect(occServerSatisfiesMinVersion('20.2.1-SNAPSHOT', '20.2.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2.1', '20.2.0-SNAPSHOT')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2.1', '20.2.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2', '20.1.9')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2', '20.1')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2.0', '20.2')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('21.1', '20.2')).toBeTruthy();
});

test('OCC Version Compare passes equal versions', () => {
  expect(occServerSatisfiesMinVersion('20.2.0', '20.2.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2', '20.2')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2', '20.2.0')).toBeTruthy();
  expect(occServerSatisfiesMinVersion('20.2.0', '20.2')).toBeTruthy();
});
