/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

function hookImports(fetcherName, selector = 'SELECTOR_PLACEHOLDER_VALUE') {
  return `import {useEffect} from 'react';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {${selector}} from '../../selectors';
import {${fetcherName}} from '..';
`;
}

function hookExportComments(fetcherName) {
  return `
/**
 * This hook will invoke the ${fetcherName} if the currency
 * list is not already available in the application state.
 */`;
}

function hookExport(fetcherName, selector = 'SELECTOR_PLACEHOLDER_VALUE') {
  return `
export default store =>
  useEffect(() => {
    // Detects if the site was populated in the state during server-side rendering
    if (isEmptyObject(${selector}(store.getState()))) {
      ${fetcherName}(store);
    }
  }, [store]);
`;
}

module.exports = options => {
  let content = '';
  content += hookImports(options.fetcherName, options.selector);
  content += hookExportComments(options.fetcherName);
  content += hookExport(options.fetcherName, options.selector);

  return [
    {
      fileName: 'hook.js',
      relativePath: '',
      content
    }
  ];
};
