/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

function hookImports(fetcherName, selector = 'SELECTOR_PLACEHOLDER_VALUE') {
  return `import {useEffect} from 'react';
import {getGlobalContext} from '@oracle-cx-commerce/commerce-utils/selector';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {${fetcherName}} from '..';
import {${selector}} from '../../../../selectors';
`;
}

const hookExportComments = `
/**
 * Custom hook
 *
 * @param {object} store The Store
 * @param {object} widgetConfig The Widget configuration values coming from Design Studio
 */`;

function hookExport(fetcherName, selector = 'SELECTOR_PLACEHOLDER_VALUE') {
  return `
export default (store, widgetConfig) => {
  useEffect(() => {
    const {contextParam} = getGlobalContext(store.getState());

    // Detects if the site was populated in the state during server-side rendering
    if (isEmptyObject(${selector}(store.getState()))) {
      ${fetcherName}(store, {});
    }
  }, [store]);
};
`;
}

module.exports = options => {
  let content = '';
  content += hookImports(options.fetcherName, options.selector);
  content += hookExportComments;
  content += hookExport(options.fetcherName, options.selector);

  return [
    {
      fileName: 'hook.js',
      relativePath: '',
      content
    }
  ];
};
