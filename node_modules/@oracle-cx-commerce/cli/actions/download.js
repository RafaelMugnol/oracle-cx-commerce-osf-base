/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

const path = require('path');
const logger = require('@oracle-cx-commerce/logger/cli');
const {downloadDeployment} = require('@oracle-cx-commerce/cli-shared');
const {getDeploymentDownloadFileLocation} = require('@oracle-cx-commerce/tools-util/deployment');
const {___} = require('@oracle-cx-commerce/tools-i18n').i18n({directory: path.join(__dirname, './locales')});

module.exports = async (appName, options) => {
  try {
    logger.info(___`Downloading deployment from ${options.appServerAdmin}...`);
    const response = await downloadDeployment({
      appName,
      deployId: options.deployment,
      preview: !options.live,
      appKey: options.appKey,
      appServerAdmin: options.appServerAdmin,
      downloadLocation: getDeploymentDownloadFileLocation(options.appServerAdmin, appName)
    });
    logger.info(___`Successfully downloaded deployment ${response.templatePath}`);
  } catch (error) {
    // log the errors
    if (error.response && error.response.status === 404) {
      logger.info(___`Deployment not found`);
    } else {
      throw error;
    }
  }
};
