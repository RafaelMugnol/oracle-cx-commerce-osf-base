/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import ActionIcon from '@oracle-cx-commerce/react-components/action-icon';
import React, {useEffect, useState, useCallback} from 'react';
import PropTypes from 'prop-types';
import Styled from '@oracle-cx-commerce/react-components/styled';
import UpIcon from '@oracle-cx-commerce/react-components/icons/up';
import css from '@oracle-cx-commerce/react-widgets/common/back-to-top-link/styles.css';
import {t, objToClassName} from '@oracle-cx-commerce/utils/generic';

/**
 * A button to go to the top of the page
 *
 * @param props
 */
const BackToTopLink = props => {
  const {backToTopAltText} = props;

  const [isHidden, setIsHidden] = useState(true);

  // eslint-disable-next-line spellcheck/spell-checker
  // TODO: Use throttling or debouncing to optimize performance
  // https://reactjs.org/docs/faq-functions.html#how-can-i-prevent-a-function-from-being-called-too-quickly-or-too-many-times-in-a-row
  useEffect(() => {
    const handleScroll = () => {
      setIsHidden(window.screenTop >= window.pageYOffset);
    };

    window.addEventListener('scroll', handleScroll);

    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  });

  const handleClick = useCallback(() => window.scrollTo({top: 0, behavior: 'smooth'}), []);

  return (
    <Styled id="BackToTopLink" css={css}>
      <div className={objToClassName({BackToTopLink: true, 'BackToTopLink--hidden': isHidden})}>
        <ActionIcon>
          <button type="button" onClick={handleClick}>
            <UpIcon altText={t(backToTopAltText)} />
          </button>
        </ActionIcon>
      </div>
    </Styled>
  );
};

BackToTopLink.propTypes = {
  /**
   * A resource string to be read aloud by voice-over for the back to top link
   */
  backToTopAltText: PropTypes.string.isRequired
};

export default BackToTopLink;
