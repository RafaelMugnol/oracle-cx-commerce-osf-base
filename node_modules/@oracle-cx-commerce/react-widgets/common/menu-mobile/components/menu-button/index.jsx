/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useCallback, useContext} from 'react';

import {MenuMobileContext} from '@oracle-cx-commerce/react-widgets/common/menu-mobile/context';
import MenuMobileIcon from '@oracle-cx-commerce/react-widgets/common/menu-mobile/components/menu-mobile-icon/';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/common/menu-mobile/components/menu-button/styles.css';

/**
 * Menu button that provides the ability to open the menu sidebar
 */
const MenuButton = React.forwardRef(function WrappedMenuButton(_props, ref) {
  const {
    closeMenuButtonId,
    menuOpen,
    toggleMenu,
    config: {menuAccessibilityOpenText, menuAccessibilityCloseText}
  } = useContext(MenuMobileContext);

  // Deal with return key to open the menu
  const handleKeyDown = useCallback(
    e => {
      if (e.key === 'Enter') ref.current.click();
    },
    [ref]
  );

  return (
    <Styled id="MenuButton" css={css}>
      <MenuMobileIcon
        className="MenuMobile__Icon"
        tabIndex="0"
        onKeyDown={handleKeyDown}
        ref={ref}
        role="button"
        aria-haspopup="true"
        aria-expanded={menuOpen}
        aria-label={menuOpen ? menuAccessibilityCloseText : menuAccessibilityOpenText}
        aria-hidden={menuOpen}
      />
      <input
        className="MenuMobile__Toggle"
        id={closeMenuButtonId}
        type="checkbox"
        checked={!!menuOpen}
        onChange={({target}) => toggleMenu(target.checked)}
      />
    </Styled>
  );
});

export default React.memo(MenuButton);
