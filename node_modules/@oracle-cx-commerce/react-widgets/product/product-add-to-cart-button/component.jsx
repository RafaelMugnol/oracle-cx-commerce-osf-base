/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import React, {useCallback, useContext} from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/product/product-add-to-cart-button/styles.css';
import {noop} from '@oracle-cx-commerce/utils/generic';
import AddToCartButton from '@oracle-cx-commerce/react-widgets/product/product-add-to-cart-button/components/add-to-cart-button';

/**
 * A widget for adding an item to the cart.
 * Validates stock status before adding item to the cart.
 * The quantity and order limits validations are performed in quantity widget
 * Displays the last item added to the cart in the mini cart.
 */
const ProductAddToCartButton = props => {
  // contexts
  const {action} = useContext(StoreContext);

  /**
   * Handler for Product Add to Cart.
   * Dispatches action when add to cart is clicked.
   * Throws validation errors if quantity added is invalid
   * @param  {Object} Object
   */
  const onAddToCart = useCallback(
    ({payload, onOk = noop, onNotOk = noop, onComplete = noop}) => {
      action('addItemsToCart', {
        items: [{...payload}]
      })
        .then(response => {
          if (response.ok === true) {
            onOk(response);
          } else {
            onNotOk(response);
          }
        })
        .catch(error => {
          onNotOk({error});
        })
        .finally(onComplete);
    },
    [action]
  );

  return (
    <Styled id="ProductAddToCartButton" css={css}>
      <div className="ProductAddToCartButton__Wrapper">
        <AddToCartButton onAddToCart={onAddToCart} {...props} />
      </div>
    </Styled>
  );
};

export default ProductAddToCartButton;
