/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {PAGE_LOGIN_LINK, PAGE_REGISTRATION_LINK} from '@oracle-cx-commerce/commerce-utils/constants';
import React, {useContext} from 'react';

import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/product/product-add-to-wishlist/components/wish-list-login-modal/styles.css';
import {getCurrentPageId} from '@oracle-cx-commerce/commerce-utils/selector';
import {useNavigator} from '@oracle-cx-commerce/react-components/link';

const URL_LOGIN = `${PAGE_LOGIN_LINK}?redirect=_prev`,
  URL_REGISTRATION = `${PAGE_REGISTRATION_LINK}?redirect=_prev`;

/**
 * Component to show a login modal when a non authenticated user clicks on add to wishlist
 * @param props
 */
const WishListLoginModal = props => {
  //locale
  const {labelAddToWishListNotLoggedIn = '', actionLogin = '', actionCreateAnAccount = ''} = props;

  //context
  const {action, getState} = useContext(StoreContext);

  const goToPage = useNavigator();

  /**
   * Method that handles navigation to login page.
   * Sets a context in component data for the wishlist modal to open automatically after login
   */
  const handleProfileNavigation = url => {
    action('saveComponentData', {
      pages: {
        [getCurrentPageId(getState())]: {
          showAddToWishList: true
        }
      }
    });

    goToPage(url);
  };

  return (
    <Styled id="WishListLoginModal" css={css}>
      <div className="WishListLoginModal" role="region" aria-labelledby="AddToWishListModal__Header">
        <span className="WishListLoginModal__Label">{labelAddToWishListNotLoggedIn}</span>
        <div className="WishListLoginModal__Buttons">
          <button type="button" onClick={() => handleProfileNavigation(URL_LOGIN)}>
            {actionLogin}
          </button>
          <button type="button" className="secondary" onClick={() => handleProfileNavigation(URL_REGISTRATION)}>
            {actionCreateAnAccount}
          </button>
        </div>
      </div>
    </Styled>
  );
};

WishListLoginModal.propTypes = {};

WishListLoginModal.defaultProps = {};

export default React.memo(WishListLoginModal);
