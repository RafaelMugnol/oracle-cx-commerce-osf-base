/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useEffect, useState, useRef} from 'react';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';

/**
 * Payer Authentication Form component which is populated with following customPaymentProperties of payment group
 * payerAuthEnrollReply_acsURL - the acs URL
 * payerAuthEnrollReply_paReq - the PA request
 * termUrl - the term url
 * MD - the merchant data
 * payerAuthEnrollReply_xid - the payer auth transaction id
 * transactionType - the transaction type
 * currencyCode - the currency Code
 * locale - the locale
 * channel - the channel
 * orderId - the order id
 * paymentId - the payment group's id
 * transactionId - the transaction id
 * transactionTimestamp - the time stamp
 * paymentMethod - the payment method
 * gatewayId - the gateway id
 * amount - the amount
 * profileId - the profile id
 * siteId - the site Id
 *
 * IMPORTANT NOTE: Ensure to update the site's allowedOriginMethods property to allow the site to accept the CORS request
 */
const PayerAuthForm = props => {
  const {callVerifyPaymentAuthorization, ...remProps} = props;
  const formRef = useRef(null);
  const [isFormSubmitted, setIsFormSubmitted] = useState(false);

  //if form is valid and customer payment properties is not empty then submit the form
  useEffect(() => {
    if (!isFormSubmitted && !isEmptyObject(remProps) && formRef && formRef.current) {
      formRef.current.submit();
      setIsFormSubmitted(true);
      callVerifyPaymentAuthorization();
    }
  }, [formRef, callVerifyPaymentAuthorization, remProps, isFormSubmitted]);

  // hidden form for populating and submitting customPaymentProperties
  return (
    <form
      name="PayerAuthForm"
      ref={formRef}
      action={remProps.payerAuthEnrollReply_acsURL}
      method="post"
      acceptCharset="UTF-8"
      target="output_frame"
      autoComplete="off"
    >
      <input type="hidden" name="PaReq" value={remProps.payerAuthEnrollReply_paReq || ''} />
      <input type="hidden" name="TermUrl" value={remProps.TermUrl || ''} />
      <input type="hidden" name="MD" value={remProps.payerAuthEnrollReply_xid || ''} />
      <input type="hidden" name="transactionType" value={remProps.transactionType || ''} />
      <input type="hidden" name="currencyCode" value={remProps.currencyCode || ''} />
      <input type="hidden" name="locale" value={remProps.locale || ''} />
      <input type="hidden" name="channel" value={remProps.channel || ''} />
      <input type="hidden" name="orderId" value={remProps.orderId || ''} />
      <input type="hidden" name="paymentId" value={remProps.paymentId || ''} />
      <input type="hidden" name="transactionId" value={remProps.transactionId || ''} />
      <input type="hidden" name="transactionTimestamp" value={remProps.transactionTimestamp || ''} />
      <input type="hidden" name="paymentMethod" value={remProps.paymentMethod || ''} />
      <input type="hidden" name="gatewayId" value={remProps.gatewayId || ''} />
      <input type="hidden" name="amount" value={remProps.amount || ''} />
      <input type="hidden" name="profileId" value={remProps.profileId || ''} />
      <input type="hidden" name="siteId" value={remProps.siteId || ''} />
    </form>
  );
};

export default PayerAuthForm;
