/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {getCurrentOrder, getPage, getOrder} from '@oracle-cx-commerce/commerce-utils/selector';
import {PAYMENT_TYPE_GIFTCARD} from '@oracle-cx-commerce/commerce-utils/constants';

export const getCheckoutGiftCardStatusData = state => {
  const contextOrderId = getPage(state).contextId;
  const currentOrder = contextOrderId ? getOrder(state, {id: contextOrderId}) : getCurrentOrder(state);

  const {paymentGroups = {}} = currentOrder;
  //get the gift card payment groups which are not expired and amount is greater than zero
  const giftCardPaymentGroups = Object.values(paymentGroups).filter(
    pGroup => pGroup.paymentMethod === PAYMENT_TYPE_GIFTCARD && !pGroup.paymentExpired && pGroup.amount > 0
  );

  return {
    giftCardPaymentGroups,
    orderState: currentOrder.state
  };
};
