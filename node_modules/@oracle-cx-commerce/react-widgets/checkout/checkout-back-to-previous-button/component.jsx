/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  PAGE_CHECKOUT_PAYMENT_AND_REVIEW_ORDER_LINK,
  PAGE_CHECKOUT_PAYMENT_LINK,
  PAGE_CHECKOUT_QUOTE_SHIPPING_LINK,
  PAGE_CHECKOUT_REVIEW_ORDER_LINK,
  PAGE_CHECKOUT_SHIPPING_LINK
} from '@oracle-cx-commerce/commerce-utils/constants';

import React from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import {connect} from '@oracle-cx-commerce/react-components/provider';
import css from '@oracle-cx-commerce/react-widgets/checkout/checkout-back-to-previous-button/styles.css';
import {getComponentData} from '@oracle-cx-commerce/react-widgets/checkout/checkout-back-to-previous-button/selectors';
import {useNavigator} from '@oracle-cx-commerce/react-components/link';
import PropTypes from 'prop-types';

/**
 * Widget to navigate to the previous checkout page
 * Widget is currently displayed in the checkout payment page
 * and is available to both checkout payment and checkout review order pages
 */
const CheckoutBackToPreviousButton = props => {
  const {actionBackToPrevious} = props;
  const {currentPageType, orderId} = props;

  const goToPage = useNavigator();

  /**
   * Click handler for the 'Back to Previous' button
   * If the current page is checkout-payment, then it navigates to the checkout shipping page
   * If the current page is checkout-review-order, then it navigates to the checkout payment page
   * If the current page is checkout-quote-payment-and-review, then it navigates to the checkout quote shipping page
   */
  const handleButtonClick = () => {
    if (currentPageType === PAGE_CHECKOUT_PAYMENT_LINK) {
      goToPage(PAGE_CHECKOUT_SHIPPING_LINK);
    } else if (currentPageType === PAGE_CHECKOUT_REVIEW_ORDER_LINK) {
      goToPage(PAGE_CHECKOUT_PAYMENT_LINK);
    } else if (currentPageType === PAGE_CHECKOUT_PAYMENT_AND_REVIEW_ORDER_LINK) {
      goToPage(`${PAGE_CHECKOUT_QUOTE_SHIPPING_LINK}/${orderId}`);
    }
  };

  return (
    <Styled id="CheckoutBackToPreviousButton" css={css}>
      <div className="CheckoutBackToPreviousButton">
        <button className="secondary" type="button" onClick={handleButtonClick}>
          {actionBackToPrevious}
        </button>
      </div>
    </Styled>
  );
};

CheckoutBackToPreviousButton.propTypes = {
  currentPageType: PropTypes.string.isRequired
};

export default connect(getComponentData)(CheckoutBackToPreviousButton);
