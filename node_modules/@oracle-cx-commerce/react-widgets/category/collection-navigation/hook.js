/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {fetchMenuCategories} from '@oracle-cx-commerce/react-widgets/category/collection-navigation/fetcher';
import {getGlobalContext} from '@oracle-cx-commerce/commerce-utils/selector';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {useEffect} from 'react';

/**
 * Custom hook that retrieves the Category (Collection) data used by the navigation menu.
 *
 * @param {object} store The Store
 * @param {object} widgetConfig The Widget configuration values
 */
export const useMenuCategoriesFetcher = (store, widgetConfig) => {
  const {numberOfChildCategoriesToDisplay = 3, hideCategoryIfOutOfStock = false} = widgetConfig;

  return useEffect(() => {
    const {categories} = getGlobalContext(store.getState());

    if (isEmptyObject(categories)) {
      // Fetch categories as not currently present in the state
      fetchMenuCategories(store, {numberOfChildCategoriesToDisplay, hideCategoryIfOutOfStock});
    }
  }, [store, numberOfChildCategoriesToDisplay, hideCategoryIfOutOfStock]);
};
