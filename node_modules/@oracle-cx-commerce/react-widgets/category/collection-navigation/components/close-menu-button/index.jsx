/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  CollectionNavCardContext,
  CollectionNavContext
} from '@oracle-cx-commerce/react-widgets/category/collection-navigation/context';
import React, {useCallback, useContext, useRef} from 'react';

import {MenuMobileContext} from '@oracle-cx-commerce/react-widgets/common/menu-mobile/context';
import MenuMobileIcon from '@oracle-cx-commerce/react-widgets/common/menu-mobile/components/menu-mobile-icon';

/**
 * Provides a close button used on the child collection card
 */
const CloseMenuButton = () => {
  const {
    config: {menuAccessibilityCloseText}
  } = useContext(MenuMobileContext);
  const {index, isVisible} = useContext(CollectionNavCardContext);

  const {closeChildCards} = useContext(CollectionNavContext);
  const ref = useRef();
  const handleClick = useCallback(() => {
    ref.current.click();
  }, [ref]);

  const handleKeyDown = useCallback(
    e => {
      if (e.key === 'Enter') handleClick(); // deal with return key
    },
    [handleClick]
  );

  return (
    <div className="CollectionNavigation__IconContainer">
      <MenuMobileIcon
        className="CollectionNavigation__CloseIcon"
        clickHandler={closeChildCards}
        ref={ref}
        aria-label={menuAccessibilityCloseText}
        tabIndex={isVisible(index) ? 0 : -1}
        role="button"
        onKeyDown={handleKeyDown}
      />
      {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions,jsx-a11y/click-events-have-key-events */}
      <div onClick={handleClick} />
    </div>
  );
};

CloseMenuButton.propTypes = {};

CloseMenuButton.defaultProps = {};

export default CloseMenuButton;
