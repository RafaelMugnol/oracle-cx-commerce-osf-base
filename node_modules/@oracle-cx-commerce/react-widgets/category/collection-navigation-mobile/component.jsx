/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import React, {useContext} from 'react';
import MenuItems from '@oracle-cx-commerce/react-widgets/category/collection-navigation-mobile/components/menu';
import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import {connect} from '@oracle-cx-commerce/react-components/provider';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/category/collection-navigation-mobile/styles.css';
import {fetchMenuCategories} from '@oracle-cx-commerce/react-widgets/category/collection-navigation/fetcher';
import {useMenuCategoriesFetcher} from '@oracle-cx-commerce/react-widgets/category/collection-navigation/hook';
import {
  getComponentData,
  getRootCategoriesData
} from '@oracle-cx-commerce/react-widgets/category/collection-navigation-mobile/selectors';

export const fetchers = [fetchMenuCategories];

/**
 * Collection Navigation Widget for mobile. Displays main menu in the nav bar and sub menu
 * in a drop down menu
 */
const CollectionNavigationMobile = props => {
  const {
    numberOfChildCategoriesToDisplay: inputNumberOfChildCategoriesToDisplay = '2',
    rootCategoryIds,
    catalogCategories,
    currentPage,
    categoryMediaProperty = ''
  } = props;
  const numberOfChildCategoriesToDisplay = parseInt(inputNumberOfChildCategoriesToDisplay, 10);

  // contexts
  const store = useContext(StoreContext);
  // hooks
  useMenuCategoriesFetcher(store, props);
  const rootCategories = getRootCategoriesData(rootCategoryIds, catalogCategories);

  return (
    <Styled id="CollectionNavigationMobile" css={css}>
      <div className="CollectionNavigationMobile">
        <MenuItems
          categories={rootCategories}
          catalogCategories={catalogCategories}
          numberOfChildCategoriesToDisplay={numberOfChildCategoriesToDisplay}
          currentPagePath={currentPage.path}
          categoryMediaProperty={categoryMediaProperty}
        />
      </div>
    </Styled>
  );
};

export default connect(getComponentData)(CollectionNavigationMobile);
