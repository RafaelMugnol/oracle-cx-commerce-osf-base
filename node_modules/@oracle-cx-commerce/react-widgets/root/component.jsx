/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {ComponentsContext} from '@oracle-cx-commerce/react-ui/contexts';
import Page from '@oracle-cx-commerce/react-components/page';
import Provider from '@oracle-cx-commerce/react-components/provider';
import React from 'react';
import {fetchSite} from '@oracle-cx-commerce/fetchers/site';
import {useSiteFetcher} from '@oracle-cx-commerce/fetchers/site/hooks';

/*
  Export [an array of] fetchers so that the server can use them to load state during 
  server-side rendering. If you want a fecther to run browser-side only then don't
  export it.
 */
export const fetchers = [fetchSite];

const Root = ({components, store}) => {
  /*
    Browser-side running of fetchers must be initiated in a `useEffect` hook.
   */
  useSiteFetcher(store);

  return (
    <ComponentsContext.Provider value={components}>
      <Provider store={store}>
        <Page />
      </Provider>
    </ComponentsContext.Provider>
  );
};

export default Root;
