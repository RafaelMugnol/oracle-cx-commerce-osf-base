/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import ExtendedCartItemsTable from '@oracle-cx-commerce/react-widgets/cart/extended-cart-item-details/components/extended-cart-items-table';
import Link from '@oracle-cx-commerce/react-components/link';
import {PAGE_HOME_LINK} from '@oracle-cx-commerce/commerce-utils/constants';
import PropTypes from 'prop-types';
import React from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import {connect} from '@oracle-cx-commerce/react-components/provider';
import css from '@oracle-cx-commerce/react-widgets/cart/extended-cart-item-details/styles.css';
import {getComponentData} from '@oracle-cx-commerce/react-widgets/cart/extended-cart-item-details/selectors';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {useCartInitializer} from '@oracle-cx-commerce/react-components/utils/cart/hooks';
/**
 * ExtendedCartItemDetails widget displays shopping cart commerce items to view each item quantity, price and promotion information.
 * It supports single/multi-shipping shipping groups of cart line items including home delivery or pick up in store as delivery options.
 * @param {*} props
 */
const ExtendedCartItemDetails = props => {
  /* Locales */
  const {messageEmptyCart, actionContinueShopping} = props;

  /* current order and shipping group info. */
  const {currentOrder, isGetCartInProgress} = props;
  const {commerceItems = {}} = currentOrder;

  /* Initializes the cart by invoking stock status and order pricing calls. */
  useCartInitializer(currentOrder, isGetCartInProgress);

  return (
    <Styled id="ExtendedCartItemDetails" css={css}>
      <div className="ExtendedCartItemDetails">
        {isGetCartInProgress !== 1 && (
          <>
            {isEmptyObject(commerceItems) ? (
              <>
                <h2 className="ExtendedCartItemDetails__EmptyMessage">{messageEmptyCart}</h2>
                <Link className="ExtendedCartItemDetails__ContiueShopping" href={PAGE_HOME_LINK}>
                  {actionContinueShopping}
                </Link>
              </>
            ) : (
              <ExtendedCartItemsTable {...props} />
            )}
          </>
        )}
      </div>
    </Styled>
  );
};

ExtendedCartItemDetails.propTypes = {
  isGetCartInProgress: PropTypes.number.isRequired,
  currentOrder: PropTypes.shape({
    commerceItems: PropTypes.objectOf(PropTypes.object)
  }).isRequired
};

export default connect(getComponentData)(ExtendedCartItemDetails);
