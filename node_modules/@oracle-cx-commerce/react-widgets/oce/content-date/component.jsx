/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useContext} from 'react';
import {ContainerContext, StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import {wrapDateItem} from '@oracle-cx-commerce/react-widgets/oce/utils';
import {getContentItems} from '@oracle-cx-commerce/commerce-utils/selector';
import css from '@oracle-cx-commerce/react-widgets/oce/content-date/styles.css';

/**
 * Content Date widget used to display selected images from content type
 */
/* eslint-disable react/no-danger */
function ContentDate(props) {
  const store = useContext(StoreContext);
  const containerContext = useContext(ContainerContext);
  const state = store.getState();

  //retrieve the json data saved in the store
  const rawData = {...getContentItems(state, containerContext)};
  const data = Object.values(rawData.contentItems);
  const {settings = {}} = props;

  if (data) {
    let contentData = '';

    for (const [key] of Object.entries(data)) {
      const {fields: contentFields} = data[key];
      const {productField: prodField} = settings;
      //loop through the json data and check if the key matches the
      // entry set in admin
      // eslint-disable-next-line no-loop-func
      Object.entries(contentFields).forEach(function ([key, value]) {
        if (key === prodField) {
          if (value) {
            contentData += wrapDateItem(value.value, key);
          }
        }
      });
    }

    return <div className="ContentDate" css={css} dangerouslySetInnerHTML={{__html: contentData}}></div>;
  }

  return <div className="ContentDate"></div>;
}

export default ContentDate;
