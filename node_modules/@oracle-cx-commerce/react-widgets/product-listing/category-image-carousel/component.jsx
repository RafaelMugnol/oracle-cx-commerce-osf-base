/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {ContainerContext} from '@oracle-cx-commerce/react-ui/contexts';
import React, {useContext} from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import Img from '@oracle-cx-commerce/react-components/img';
import {isMobile} from '@oracle-cx-commerce/commerce-utils/selector';
import {useSelector} from '@oracle-cx-commerce/react-components/provider';
import GenericCarousel from '@oracle-cx-commerce/react-components/generic-carousel';
import css from '@oracle-cx-commerce/react-widgets/product-listing/category-image-carousel/styles.css';

/**
 * Widget that displays all the images that are configured for a particular category
 */
const CategoryImageCarousel = props => {
  //Widget config
  const {tagTypeDropdown = 'heroTag', autoSlideImagesInterval = 3, isAutoSlide = true} = props;
  //Context
  const {categoryImages = []} = useContext(ContainerContext);
  //config extend
  const {itemsPerSlideDesktop = 1, itemsPerSlideMobile = 1, showIndicator = true} = props;
  //selector
  const mobile = useSelector(isMobile);

  const slides = [];

  if (categoryImages.length > 0) {
    categoryImages.forEach(image => {
      ((image || {}).tags || []).forEach(tag => {
        if (tag.repositoryId === tagTypeDropdown) {
          slides.push(<Img key={image.repositoryId} src={image.url} alt="" />);
        }
      });
    });
  }

  if (slides.length === 0) {
    return null;
  }

  return (
    <Styled id="CategoryImageCarousel" css={css}>
      {tagTypeDropdown === 'heroTag' ? (
        <div className="CategoryImageCarousel">
          <GenericCarousel
            slides={slides}
            mobile={mobile}
            itemsPerSlideDesktop={itemsPerSlideDesktop}
            showIndicator={showIndicator}
            autoSlideInterval={autoSlideImagesInterval}
            isAutoSlide={isAutoSlide}
            itemsPerSlideMobile={itemsPerSlideMobile}
          />
        </div>
      ) : (
        <div className="CategoryImageCarousel__Images">{slides}</div>
      )}
    </Styled>
  );
};

export default CategoryImageCarousel;
