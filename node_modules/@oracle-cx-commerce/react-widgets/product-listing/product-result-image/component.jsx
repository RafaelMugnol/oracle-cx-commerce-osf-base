/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useContext} from 'react';

import Img from '@oracle-cx-commerce/react-components/img';
import Link from '@oracle-cx-commerce/react-components/link';
import {ProductContext} from '@oracle-cx-commerce/react-ui/contexts';
import {ProductListingContext} from '@oracle-cx-commerce/react-widgets/contexts';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/product-listing/product-result-image/styles.css';

/**
 * Displays a product image for use in search results
 */
const ProductResultImage = () => {
  const {mobile} = useContext(ProductListingContext);
  const {record = {}, route = '', selection = {}} = useContext(ProductContext);

  // Get image url. If one has been set by selecting a color swatch, display that image
  const imageUrl =
    selection['imageUrl'] ||
    (record.attributes['sku.listingFullImageURL'] && record.attributes['sku.listingFullImageURL'][0]) ||
    (record.attributes['product.primaryFullImageURL'] && record.attributes['product.primaryFullImageURL'][0]);

  const altText =
    record.attributes['product.primaryImageAltText'] && record.attributes['product.primaryImageAltText'][0];

  // Determine the imageWidth
  const imageWidth = mobile ? 'var(--mobile-product-image-width)' : 'var(--desktop-product-image-width)';

  return (
    <Styled id="ProductResultImage" css={css}>
      <Link href={route} className="ProductResultImage">
        <Img
          className="ProductResultImage__Image"
          style={{height: 'auto', width: imageWidth}}
          src={imageUrl}
          alt={altText}
          size="small"
        />
      </Link>
    </Styled>
  );
};

export default ProductResultImage;
