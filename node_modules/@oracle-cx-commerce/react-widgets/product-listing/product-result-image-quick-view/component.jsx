/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useContext, useState, useCallback} from 'react';

import Link from '@oracle-cx-commerce/react-components/link';
import {ProductContext} from '@oracle-cx-commerce/react-ui/contexts';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/product-listing/product-result-image-quick-view/styles.css';
import QuickViewButton from '@oracle-cx-commerce/react-widgets/product-listing/product-result-image-quick-view/components/quick-view-button';
import ProductImage from '@oracle-cx-commerce/react-widgets/product-listing/product-result-image-quick-view/components/product-image';

/**
 * Displays a product image for use in search results with quick view enabled
 */
const ProductResultImageQuickView = props => {
  const {record = {attributes: {}}, route = '', selection = {}} = useContext(ProductContext);

  const [isHidden, setIsHidden] = useState(true);

  // Get image url. If one has been set by selecting a color swatch, display that image
  const imageUrl =
    selection['imageUrl'] ||
    (record.attributes['sku.listingFullImageURL'] && record.attributes['sku.listingFullImageURL'][0]) ||
    (record.attributes['product.primaryFullImageURL'] && record.attributes['product.primaryFullImageURL'][0]) ||
    '';

  const altText =
    (record.attributes['product.primaryImageAltText'] && record.attributes['product.primaryImageAltText'][0]) || '';

  const handleMouseOver = useCallback(() => setIsHidden(false), []);
  const handleMouseOut = useCallback(() => setIsHidden(true), []);

  return (
    <Styled id="ProductResultImageQuickView" css={css}>
      <div
        className="ProductResultImageQuickView"
        onMouseOver={handleMouseOver}
        onFocus={handleMouseOver}
        onMouseOut={handleMouseOut}
        onBlur={handleMouseOut}
      >
        <Link href={route}>
          <ProductImage imageUrl={imageUrl} altText={altText} />
        </Link>
        <QuickViewButton
          isHidden={isHidden}
          handleMouseOut={handleMouseOut}
          imageUrl={imageUrl}
          altText={altText}
          {...props}
        ></QuickViewButton>
      </div>
    </Styled>
  );
};

export default ProductResultImageQuickView;
