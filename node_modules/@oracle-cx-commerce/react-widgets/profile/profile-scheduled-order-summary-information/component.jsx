/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {OrderContext, ContainerContext} from '@oracle-cx-commerce/react-ui/contexts';
import React, {useContext} from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/profile/profile-scheduled-order-summary-information/styles.css';
import Card from '@oracle-cx-commerce/react-components/card';
import {useDateFormatter} from '@oracle-cx-commerce/react-components/utils/hooks';
import {getFrequencyFromSchedule} from '@oracle-cx-commerce/react-widgets/profile/profile-scheduled-order-summary-information/utils';

/**
 * Widget that displays the scheduled order summary information in the Scheduled Order Details Page
 *
 * @param props
 */
const ProfileScheduledOrderSummaryInformation = props => {
  const {
    textScheduleId,
    textScheduleLastOrderDate,
    textScheduleNextOrderDate,
    textScheduleStatus,
    textApproverName,
    textApproverReasons,
    textApproverComments,
    textScheduleFrequency,
    textOrderStatus
  } = props;
  //order context
  const scheduledOrder = useContext(ContainerContext);
  const order = useContext(OrderContext);
  const {id, lastScheduledRun, nextScheduledRun, state} = scheduledOrder;
  const {approvalSystemMessages, approverMessages, approvers, orderStatus} = order;
  const {firstName, lastName} = approvers ? approvers[0] : {};
  const formatDate = useDateFormatter();
  const {schedule} = scheduledOrder;
  const frequency = getFrequencyFromSchedule(schedule, {...props});

  return (
    <Styled id="ProfileScheduledOrderSummaryInformation" css={css}>
      {id && scheduledOrder && (
        <div className="ProfileScheduledOrderSummaryInformation">
          <Card type="secondary" className="ProfileScheduledOrderSummaryInformation__Card">
            {/* Order Number */}
            <div className="ProfileScheduledOrderSummaryInformation__Row">
              <span className="ProfileScheduledOrderSummaryInformation__Label">{textScheduleId}</span>

              <span className="ProfileScheduledOrderSummaryInformation__Value">{id}</span>
            </div>

            {/* Order Frequency */}
            <div className="ProfileScheduledOrderSummaryInformation__Row">
              <span className="ProfileScheduledOrderSummaryInformation__Label">{textScheduleFrequency}</span>

              <span className="ProfileScheduledOrderSummaryInformation__Value">{frequency}</span>
            </div>

            {lastScheduledRun && (
              <div className="ProfileScheduledOrderSummaryInformation__Row">
                <span className="ProfileScheduledOrderSummaryInformation__Label">{textScheduleLastOrderDate}</span>

                <span className="ProfileScheduledOrderSummaryInformation__Value">
                  {formatDate(new Date(lastScheduledRun))}
                </span>
              </div>
            )}

            {/* Next Order Date */}
            {nextScheduledRun && (
              <div className="ProfileScheduledOrderSummaryInformation__Row">
                <span className="ProfileScheduledOrderSummaryInformation__Label">{textScheduleNextOrderDate}</span>

                <span className="ProfileScheduledOrderSummaryInformation__Value">
                  {formatDate(new Date(nextScheduledRun))}
                </span>
              </div>
            )}

            {/* Order Status */}
            <div className="ProfileScheduledOrderSummaryInformation__Row">
              <span className="ProfileScheduledOrderSummaryInformation__Label">{textOrderStatus}</span>

              <span className="ProfileScheduledOrderSummaryInformation__CapitalizedValue">{orderStatus}</span>
            </div>

            <div className="ProfileScheduledOrderSummaryInformation__Row">
              <span className="ProfileScheduledOrderSummaryInformation__Label">{textScheduleStatus}</span>

              <span className="ProfileScheduledOrderSummaryInformation__CapitalizedValue">{state}</span>
            </div>

            {firstName && (
              <div className="ProfileScheduledOrderSummaryInformation__Row">
                <span className="ProfileScheduledOrderSummaryInformation__Label">{textApproverName}</span>

                <span className="ProfileScheduledOrderSummaryInformation__CapitalizedValue">{`${firstName} ${lastName}`}</span>
              </div>
            )}

            {/* Approval Reasons */}
            {approvalSystemMessages && approvalSystemMessages.length > 0 && (
              <div className="ProfileScheduledOrderSummaryInformation__Row">
                <span className="ProfileScheduledOrderSummaryInformation__Label">{textApproverReasons}</span>
              </div>
            )}
            {approvalSystemMessages &&
              approvalSystemMessages.length > 0 &&
              approvalSystemMessages.map(approvalSystemMessage => (
                <div key={approvalSystemMessage} className="ProfileScheduledOrderSummaryInformation__Row">
                  <div className="ProfileScheduledOrderSummaryInformation__Message">{approvalSystemMessage}</div>
                </div>
              ))}

            {/* Approval Messages */}

            {approverMessages && approverMessages.length > 0 && (
              <div className="ProfileScheduledOrderSummaryInformation__Row">
                <span className="ProfileScheduledOrderSummaryInformation__Label">{textApproverComments}</span>
              </div>
            )}
            {approverMessages &&
              approvalSystemMessages.length > 0 &&
              approverMessages.map(approverMessage => (
                <div key={approverMessage} className="ProfileScheduledOrderSummaryInformation__Row">
                  <div className="ProfileScheduledOrderSummaryInformation__Message">{approverMessage}</div>
                </div>
              ))}
          </Card>
        </div>
      )}
    </Styled>
  );
};

export default ProfileScheduledOrderSummaryInformation;
