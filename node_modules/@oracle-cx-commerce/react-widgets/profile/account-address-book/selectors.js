/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  getContactInfos,
  getCurrentOrganizationId,
  getCurrentProfileId,
  getEndpointStatus,
  getOrganizations,
  getRoles,
  isAuthenticated,
  getCurrentProfileRoleIds
} from '@oracle-cx-commerce/commerce-utils/selector';
import {arrayToMap} from '@oracle-cx-commerce/utils/generic';

export const getComponentData = state => {
  const isUserLoggedIn = isAuthenticated(state) && getCurrentProfileId(state) !== 'anonymous';
  const contactInfos = getContactInfos(state);
  const currentOrganization = getOrganizations(state)[getCurrentOrganizationId(state)] || {};
  const roleIds = getCurrentProfileRoleIds(state);
  const rolesArray = roleIds.map(roleId => getRoles(state)[roleId]) || [];
  const roles = arrayToMap(rolesArray, 'repositoryId') || {};

  const isGetOrganizationDefaultAddressInProgress = getEndpointStatus(state).getOrganizationDefaultAddresses
    ? getEndpointStatus(state).getOrganizationDefaultAddresses.inProgress
    : 1;

  return {
    isUserLoggedIn,
    contactInfos,
    currentOrganization,
    isGetOrganizationDefaultAddressInProgress,
    roles
  };
};
