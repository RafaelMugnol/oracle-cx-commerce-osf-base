/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import React, {useContext, useEffect, useState} from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import PurchaseListsDetails from '@oracle-cx-commerce/react-widgets/profile/profile-purchase-lists-summary/components/purchase-lists-details';
import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import css from '@oracle-cx-commerce/react-widgets/profile/profile-purchase-lists-summary/styles.css';

/**
 * Widget to display the purchase lists summary at profile page.
 * @param {Object} props the properties object
 */
const ProfilePurchaseListsSummary = props => {
  const {action} = useContext(StoreContext);
  const {headingPurchaseLists} = props;

  const [purchaseLists, setPurchaseLists] = useState();
  const [sharedPurchaseLists, setSharedPurchaseLists] = useState();

  useEffect(() => {
    /* Get the count of purchase list created by me */
    action('listPurchaseLists', {
      purchaseListItemCount: true
    }).then(response => {
      if (response.ok && response.json && response.json.items) {
        setPurchaseLists(response.json.totalResults);
      }
    });

    /* Get the count of purchase list shared with me */
    action('listPurchaseLists', {
      listType: 'shared',
      purchaseListItemCount: true
    }).then(response => {
      if (response.ok && response.json && response.json.items) {
        setSharedPurchaseLists(response.json.totalResults);
      }
    });
  }, [action, setPurchaseLists, setSharedPurchaseLists]);

  return (
    <Styled id="ProfilePurchaseListsSummary" css={css}>
      <div className="ProfilePurchaseListsSummary">
        <h2>{headingPurchaseLists}</h2>
        <PurchaseListsDetails purchaseLists={purchaseLists} sharedPurchaseLists={sharedPurchaseLists} {...props} />
      </div>
    </Styled>
  );
};

export default ProfilePurchaseListsSummary;
