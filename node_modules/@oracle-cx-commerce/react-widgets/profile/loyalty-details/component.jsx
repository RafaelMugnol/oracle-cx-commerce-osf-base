/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import {connect} from '@oracle-cx-commerce/react-components/provider';
import Styled from '@oracle-cx-commerce/react-components/styled';
import React, {useState} from 'react';
import Card from '@oracle-cx-commerce/react-components/card';
import {getLoyaltyData} from '@oracle-cx-commerce/react-widgets/profile/loyalty-details/selectors';
import css from '@oracle-cx-commerce/react-widgets/profile/loyalty-details/styles.css';
import PageLoader from '@oracle-cx-commerce/react-components/page-loader';
import {useLoyaltyDetailsInitializer} from '@oracle-cx-commerce/react-widgets/profile/loyalty-details/hook';
/**
 * A component for listing profile related Loyalty programs.
 * List of Loyalty programs and loyalty details will be displayed
 */
const LoyaltyDetails = props => {
  const [showWidget, setShowWidget] = useState(false);
  const {
    profileId,
    loyaltyPrograms,
    labelLoyaltyDetails,
    labelProgramName,
    labelMembershipId,
    labelLoyaltyCategory,
    labelCurrentPointBalance,
    labelLoyaltyBalanceText,
    messageNoLoyaltyPrograms
  } = props;

  useLoyaltyDetailsInitializer({profileId, setShowWidget});

  return (
    <Styled id="LoyaltyDetails" css={css}>
      <div className="LoyaltyDetails">
        <h1>{labelLoyaltyDetails}</h1>
        {(showWidget && (
          <div className="LoyaltyDetails__ProgramsList">
            {(Object.keys(loyaltyPrograms || {}).length > 0 &&
              (Object.keys(loyaltyPrograms || {}) || []).map(
                programId =>
                  loyaltyPrograms[programId].loyaltyPointDetails &&
                  loyaltyPrograms[programId].loyaltyPointDetails.length > 0 &&
                  loyaltyPrograms[programId].loyaltyPointDetails.map(pointsDetails => {
                    return (
                      <Card key={programId + pointsDetails.pointsType}>
                        <div>
                          <div className="LoyaltyDetails__Label">{labelProgramName}</div>
                          <div className="LoyaltyDetails__Value">{loyaltyPrograms[programId].programName}</div>
                        </div>
                        <div>
                          <div className="LoyaltyDetails__Label">{labelMembershipId}</div>
                          <div className="LoyaltyDetails__Value">{loyaltyPrograms[programId].membershipId}</div>
                        </div>
                        <div>
                          <div className="LoyaltyDetails__Label">{labelLoyaltyCategory}</div>
                          <div className="LoyaltyDetails__Value">{pointsDetails.membershipType}</div>
                        </div>
                        <div>
                          <div className="LoyaltyDetails__Label">{labelCurrentPointBalance}</div>
                          <div className="LoyaltyDetails__Balance">{pointsDetails.pointsBalance}</div>
                        </div>
                        <div>{labelLoyaltyBalanceText}</div>
                      </Card>
                    );
                  })
              )) || <div>{messageNoLoyaltyPrograms}</div>}
          </div>
        )) || (
          <PageLoader show={!showWidget}>
            <div className="LoyaltyDetails__ProgramsList">
              <Card className="LoyaltyDetails__Loader"></Card>
              <Card className="LoyaltyDetails__Loader"></Card>
            </div>
          </PageLoader>
        )}
      </div>
    </Styled>
  );
};

export default connect(getLoyaltyData)(LoyaltyDetails);
