/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useContext, useEffect} from 'react';
import {getPage, getReturnRequest} from '@oracle-cx-commerce/commerce-utils/selector';

import Region from '@oracle-cx-commerce/react-components/region';
import {ReturnContext} from '@oracle-cx-commerce/react-widgets/contexts';
import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/profile/profile-return-details-container/styles.css';
import {useSelector} from '@oracle-cx-commerce/react-components/provider';

/**
 * Display details of the return request by invoking the respective widgets.
 * Needs return request Id for which the return details are to be displayed.
 */
const ProfileReturnDetailsContainer = props => {
  const {regions = [], className = '', headingReturnDetails} = props;
  const showReturnReason = true;
  const {action} = useContext(StoreContext);
  const returnId = useSelector(getPage).contextId;
  // trigger an action to get the return request details
  useEffect(() => {
    action('getReturnRequest', {id: returnId});
  }, [action, returnId]);
  const returnDetails = useSelector(getReturnRequest, returnId) || {};
  // render the details only after the state has the details, after the 'getReturnRequest' action is fulfilled
  if (returnDetails.returnRequestId) {
    return (
      <Styled id="ProfileReturnDetailsContainer" css={css}>
        <div className="ProfileReturnDetailsContainer">
          <h1 className="ProfileReturnDetailsContainer__Label">{headingReturnDetails}</h1>
          <section className={`ProfileReturnDetailsContainer__Section ${className}`.trim()}>
            <ReturnContext.Provider value={{returnDetails, showReturnReason}}>
              {regions.map((regionId, index) => (
                // eslint-disable-next-line react/no-array-index-key
                <Region key={index} regionId={regionId} />
              ))}
            </ReturnContext.Provider>
          </section>
        </div>
      </Styled>
    );
  }

  return null;
};

export default ProfileReturnDetailsContainer;
