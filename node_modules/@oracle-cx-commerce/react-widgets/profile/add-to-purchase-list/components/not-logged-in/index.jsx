/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {useContext} from 'react';
import {StoreContext} from '@oracle-cx-commerce/react-ui/contexts';
import {getCurrentPageId} from '@oracle-cx-commerce/commerce-utils/selector';
import {useNavigator} from '@oracle-cx-commerce/react-components/link';
import {PAGE_LOGIN_LINK, PAGE_REGISTRATION_LINK} from '@oracle-cx-commerce/commerce-utils/constants';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/profile/add-to-purchase-list/components/not-logged-in/styles.css';

const URL_LOGIN = `${PAGE_LOGIN_LINK}?redirect=_prev`,
  URL_REGISTRATION = `${PAGE_REGISTRATION_LINK}?redirect=_prev`;

/**
 * Component to show when a shopper who is not logged in tries to add
 * an item to purchase list.
 *
 * @param props
 */
const NotLoggedIn = props => {
  const {labelAddToPurchaseListNotLoggedIn = '', actionLogin = '', actionCreateAnAccount = ''} = props;

  const {action, getState} = useContext(StoreContext);

  const goToPage = useNavigator();

  const handleProfileNavigation = url => {
    action('saveComponentData', {
      pages: {
        [getCurrentPageId(getState())]: {
          showAddToPurchaseList: true
        }
      }
    });

    goToPage(url);
  };

  return (
    <Styled id="AddToPurchaseListModal__NotLoggedIn" css={css}>
      <div
        className="AddToPurchaseListModal__NotLoggedIn"
        role="region"
        aria-labelledby="AddToPurchaseListModal__Header"
      >
        <span className="AddToPurchaseListModal__NotLoggedInLabel">{labelAddToPurchaseListNotLoggedIn}</span>
        <div className="AddToPurchaseListModal__NotLoggedInButtons">
          <button type="button" onClick={() => handleProfileNavigation(URL_LOGIN)}>
            {actionLogin}
          </button>
          <button type="button" className="secondary" onClick={() => handleProfileNavigation(URL_REGISTRATION)}>
            {actionCreateAnAccount}
          </button>
        </div>
      </div>
    </Styled>
  );
};

NotLoggedIn.propTypes = {};

NotLoggedIn.defaultProps = {};

export default React.memo(NotLoggedIn);
