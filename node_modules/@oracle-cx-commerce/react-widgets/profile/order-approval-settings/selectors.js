/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  getCurrencyCode,
  getCurrentOrganizationId,
  getCurrentProfile,
  getOrganizations,
  getPriceListGroup,
  getRoles
} from '@oracle-cx-commerce/commerce-utils/selector';

import {ADMIN} from '@oracle-cx-commerce/commerce-utils/constants/roles';

export const getComponentData = state => {
  const roles = getRoles(state);
  const currentOrganizationId = getCurrentOrganizationId(state);
  const currentOrganization = getOrganizations(state)[currentOrganizationId] || {};
  const {delegateApprovalManagement, orderPriceLimit, approvalRequired} = currentOrganization;
  const currentProfile = getCurrentProfile(state);

  const {priceListGroup: {id: priceListGroupId} = {}} = currentProfile || {};

  const priceListGroup = getPriceListGroup(state, priceListGroupId);
  const isDelegatedAdmin =
    currentProfile.roles &&
    (currentProfile.roles.find(roleId => {
      return roles[roleId].function === ADMIN;
    }) !== undefined
      ? true
      : false);
  const currencyCode = getCurrencyCode(state);

  return {
    currentOrganizationId,
    delegateApprovalManagement,
    orderPriceLimit,
    isDelegatedAdmin,
    approvalRequired,
    priceListGroup,
    currencyCode
  };
};
