/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  getCurrentOrganizationId,
  getCurrentProfileId,
  getProfiles,
  getRoles,
  isAuthenticated
} from '@oracle-cx-commerce/commerce-utils/selector';

import {ADMIN} from '@oracle-cx-commerce/commerce-utils/constants/roles';

export const getComponentData = state => {
  const profiles = getProfiles(state);
  const roles = getRoles(state);
  const currentOrganizationId = getCurrentOrganizationId(state);
  const curProfileId = getCurrentProfileId(state);
  const isUserLoggedIn = isAuthenticated(state) && getCurrentProfileId(state) !== 'anonymous';

  const isDelegatedAdmin =
    isUserLoggedIn &&
    profiles[curProfileId] &&
    profiles[curProfileId].roles &&
    profiles[curProfileId].roles.find(roleId => {
      return roles[roleId].function === ADMIN;
    }) !== undefined
      ? true
      : false;

  return {
    profiles,
    roles,
    currentOrganizationId,
    isDelegatedAdmin
  };
};
