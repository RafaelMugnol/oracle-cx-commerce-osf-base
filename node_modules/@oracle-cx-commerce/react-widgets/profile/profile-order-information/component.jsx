/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {OrderContext} from '@oracle-cx-commerce/react-ui/contexts';
import React, {useContext} from 'react';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-widgets/profile/profile-order-information/styles.css';
import {useDateFormatter, useNumberFormatter} from '@oracle-cx-commerce/react-components/utils/hooks';

/**
 * Widget that displays basic order related information
 * such as order date, order number, order status, number of items, order total, etc.
 */
const ProfileOrderInformation = props => {
  //resources
  const {
    textOrderDate,
    textOrderNumber,
    textNumberOfItems,
    textOrderStatus,
    textOrderTotal,
    textNone,
    textCreationDate,
    textApproverComments,
    textApproverReasons,
    textApproverName,
    orderStatusRejectQuote,
    orderStatusReRequestQuote
  } = props;

  //order context
  const order = useContext(OrderContext);
  const {
    id,
    submittedDate,
    numberOfItems,
    priceInfo = {},
    priceListGroup,
    creationDate,
    approvalSystemMessages,
    approverMessages,
    approvers,
    state
  } = order;
  let {orderStatus} = order;

  const {firstName: approverFirstName, lastName: approverLastName} = approvers ? approvers[0] : {};

  const formatCurrency = useNumberFormatter({style: 'currency'}, priceListGroup);
  const formatDate = useDateFormatter();
  const orderedDate = submittedDate || creationDate;

  if (state === 'PENDING_QUOTE') {
    orderStatus = orderStatusReRequestQuote;
  }
  if (state === 'REJECTED_QUOTE') {
    orderStatus = orderStatusRejectQuote;
  }

  return (
    <Styled id="ProfileOrderInformation" css={css}>
      <div className="ProfileOrderInformation">
        {id && (
          <>
            {/* Order Number */}
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textOrderNumber}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">{id}</span>
              </div>
            </div>

            {/* Order Date */}
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textOrderDate}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">
                  {orderedDate ? formatDate(new Date(orderedDate)) : textNone}
                </span>
              </div>
            </div>
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textCreationDate}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">
                  {creationDate ? formatDate(new Date(creationDate)) : textNone}
                </span>
              </div>
            </div>

            {/* Order Status */}
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textOrderStatus}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">{orderStatus}</span>
              </div>
            </div>

            {/* Number of Items */}
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textNumberOfItems}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">{numberOfItems}</span>
              </div>
            </div>

            {/* Order Total */}
            <div className="ProfileOrderInformation__Row">
              <div className="ProfileOrderInformation__LabelCol">
                <span className="ProfileOrderInformation__Label">{textOrderTotal}</span>
              </div>
              <div className="ProfileOrderInformation__ValueCol">
                <span className="ProfileOrderInformation__Value">{formatCurrency(priceInfo.total)}</span>
              </div>
            </div>

            {approverFirstName && (
              <div className="ProfileOrderInformation__Row">
                <div className="ProfileOrderInformation__LabelCol">
                  <span className="ProfileOrderInformation__Label">{textApproverName}</span>
                </div>
                <div className="ProfileOrderInformation__ValueCol">
                  <span className="ProfileOrderInformation__Value">{`${approverFirstName} ${approverLastName}`}</span>
                </div>
              </div>
            )}

            {/* Approval Reasons */}
            {approvalSystemMessages && approvalSystemMessages.length > 0 && (
              <div className="ProfileOrderInformation__Row">
                <span className="ProfileOrderInformation__Label">{textApproverReasons}</span>
              </div>
            )}
            {approvalSystemMessages &&
              approvalSystemMessages.length > 0 &&
              approvalSystemMessages.map(approvalSystemMessage => (
                <div key={approvalSystemMessage} className="ProfileOrderInformation__Row">
                  <div className="ProfileOrderInformation__Message">{approvalSystemMessage}</div>
                </div>
              ))}

            {/* Approval Messages */}

            {approverMessages && approverMessages.length > 0 && (
              <>
                <div className="ProfileOrderInformation__Row">
                  <span className="ProfileOrderInformation__Label">{textApproverComments}</span>
                </div>
                {approverMessages.map(approverMessage => (
                  <div key={approverMessage} className="ProfileOrderInformation__Row">
                    <div className="ProfileOrderInformation__Message">{approverMessage}</div>
                  </div>
                ))}
              </>
            )}
          </>
        )}
      </div>
    </Styled>
  );
};

export default ProfileOrderInformation;
