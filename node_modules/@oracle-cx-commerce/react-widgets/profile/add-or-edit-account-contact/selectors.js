/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {
  getCurrentOrganizationId,
  getCurrentProfileId,
  getPage,
  getProfiles,
  getRoles
} from '@oracle-cx-commerce/commerce-utils/selector';

import {ADMIN} from '@oracle-cx-commerce/commerce-utils/constants/roles';

export const getComponentData = state => {
  const profiles = getProfiles(state);
  const allRoles = getRoles(state);
  const currentOrganizationId = getCurrentOrganizationId(state);
  const roles = Object.values(allRoles).filter(roleInfo => {
    return roleInfo.relativeTo === currentOrganizationId;
  });
  const currentProfileId = getCurrentProfileId(state);
  const currentContactId = getPage(state).contextId;

  const currentContactProfile = profiles[currentContactId];

  const isDelegatedAdmin =
    profiles[currentProfileId] &&
    profiles[currentProfileId].roles &&
    profiles[currentProfileId].roles.find(roleId => {
      return allRoles[roleId].function === ADMIN;
    }) !== undefined
      ? true
      : false;

  return {
    roles,
    currentOrganizationId,
    isDelegatedAdmin,
    isEditAddress: currentContactId ? true : false,
    currentContactProfile,
    currentContactId,
    currentLoggedInUserId: currentProfileId
  };
};
