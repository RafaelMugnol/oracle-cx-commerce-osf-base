/*
 ** Copyright (c) 2021 Oracle and/or its affiliates.
 */

import {getContentSettings, getContentSiteUrl} from '@oracle-cx-commerce/commerce-utils/selector';
import {createEndpointFactory} from '@oracle-cx-commerce/endpoints/utils/endpoint-factory';

export const createOceEndpoint = createEndpointFactory({
  apiCatalogPaths: ['/content/published/api/v1.1/swagger.json'],
  getOrigin({state}) {
    return getContentSiteUrl(state);
  },
  getHeaders({state, location}) {
    const contentSettings = getContentSettings(state);
    const host = contentSettings.url.split('//')[1];
    const headers = {
      accessToken: contentSettings.accessToken,
      'X-CCProfileType': 'storefrontUI',
      'X-CC-MeteringMode': 'CC-NonMetered',
      'X-CC-Frontend-Forwarded-Url': location.host + location.pathname + location.search,
      host
    };

    return headers;
  }
});
