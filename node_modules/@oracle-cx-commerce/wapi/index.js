/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

export const createWapi = ({endpoints}) => {
  console.assert(endpoints, `Missing argument "endpoints"`);

  const wapi = {
    async endpoint(name, payload, state) {
      console.assert(typeof endpoints[name] === 'function', `Missing loader for endpoint "${name}"`);

      const fetch = typeof self !== 'undefined' ? self.fetch : state.global.fetch;

      console.assert(typeof fetch === 'function', `Missing "fetch" function`);

      const {getRequest, getResponse} = (await endpoints[name]()).default;

      const request = await getRequest(payload, state, fetch);

      const response = getResponse(await fetch(request), state, payload);

      return response;
    }
  };

  return wapi;
};
