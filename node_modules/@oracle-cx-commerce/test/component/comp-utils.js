/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React, {lazy} from 'react';
// eslint-disable-next-line import/named
import {render, waitForDomChange} from './custom-render';
import {createMockStore} from './create-mock-store';

const wrapper = async (initialState, delta, component, props = {}, timeout = 500) => {
  // TODO: checks on sanity of passed data
  const mockStore = createMockStore(initialState || {});
  mockStore.mutateState(delta); // change the state to match to this test req
  // TODO: Validate sanity of component passed
  const ReactComponent = lazy(() => import(component));
  const ret = render(<ReactComponent {...props} />, mockStore);
  await waitForDomChange(ret.container, {timeout}); // wait for text / button to be present in screen

  return ret;
};

export {wrapper};
