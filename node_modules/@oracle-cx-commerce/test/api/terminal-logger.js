/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {log} from '@oracle-cx-commerce/test/api';

const {changeLogLevel} = require('@oracle-cx-commerce/logger/common');
const jsonpatch = require('fast-json-patch');

export const createTerminalLogger = () => {
  changeLogLevel(log, 'debug');

  return store => next => action => {
    const prevState = store.getState();

    const actionData = `--> Dispatching
  action: ${action.type},
  endpointId: ${action.endpointId || 'undefined'},
  originalType: ${action.originalType || 'undefined'},
  payload: ${JSON.stringify(action.payload, null, 2)}`;

    log.verbose(actionData);

    const result = next(action);
    const currentState = store.getState();
    const diff = jsonpatch.compare(prevState, currentState);

    const stateChange = `[Î”] State Changes
  action: ${action.type}
  ${JSON.stringify(diff, null, 2)}`;

    log.verbose(stateChange);

    return result;
  };
};
export default createTerminalLogger;
