/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {transformSavedCardResponse} from '@oracle-cx-commerce/endpoints/utils/transform/profile';

/**
 * Endpoint adapter for the 'getCreditCard' action.
 */
export default createEndpoint('getCreditCard', {
  /**
   * Returns card savedCardId to retrieve corresponding card details.
   * @param payload, contains card's savedCardId
   * @returns, request path params.
   */
  processInput(payload) {
    const {savedCardId} = payload;
    console.assert(
      savedCardId !== undefined,
      'getCreditCard endpoint requires a savedCardId to be specified in the payload'
    );

    return {
      params: [savedCardId]
    };
  },
  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   * @param response the response object
   * @param state, the application state object
   * @returns partial state object to be merged with application state
   */
  async processOutput(response, state) {
    const json = await getBodyAsJson(response);

    return response.ok ? transformSavedCardResponse(state, json) : populateError(response, json);
  }
});
