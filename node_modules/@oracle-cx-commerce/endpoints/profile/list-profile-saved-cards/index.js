/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {transformListSavedCardsResponse} from '@oracle-cx-commerce/endpoints/utils/transform/profile';

/**
 * Endpoint adapter for the 'listCreditCards' action.
 */
export default createEndpoint('listCreditCards', {
  /**
   * Returns query parameters to be used in request to list cards details
   * @param queryParams the query parameters
   * @returns query param for request
   */
  processInput(queryParams) {
    return {
      query: queryParams
    };
  },
  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   * @param response the response object
   * @param state, the application state object
   * @returns partial state model to be merged with application state
   */
  async processOutput(response, state) {
    const json = await getBodyAsJson(response);
    const {items} = json;

    return response.ok ? transformListSavedCardsResponse(state, items) : populateError(response, json);
  }
});
