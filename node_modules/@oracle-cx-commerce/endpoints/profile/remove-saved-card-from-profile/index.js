/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {removeSavedCard} from '@oracle-cx-commerce/endpoints/utils/transform/profile';

/**
 * Endpoint adapter for the 'removeCreditCard' action.
 */
export default createEndpoint('removeCreditCard', {
  /**
   * Returns savedCardId for card which is to be removed
   * @param payload, contains savedCardId of card which is to be removed
   * @returns, request params.
   */
  processInput(payload) {
    const {savedCardId} = payload;
    console.assert(
      savedCardId !== undefined,
      'removeCreditCard endpoint requires a savedCardId to be specified in payload.'
    );

    return {
      params: [savedCardId]
    };
  },
  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   * @param response the response object
   * @param state, the application state object
   * @returns partial state to be merged with application state
   */
  async processOutput(response, state) {
    const json = await getBodyAsJson(response);

    return response.ok ? removeSavedCard(state, json) : populateError(response, json);
  }
});
