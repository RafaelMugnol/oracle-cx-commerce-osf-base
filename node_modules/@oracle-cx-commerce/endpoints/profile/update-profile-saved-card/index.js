/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {transformSavedCardResponse} from '@oracle-cx-commerce/endpoints/utils/transform/profile';

/**
 * Endpoint adapter for the 'updateCreditCard' action.
 */
export default createEndpoint('updateCreditCard', {
  /**
   * Returns card savedCardId and payload to update card.
   * @param payload, contains savedCardId of card which is to be updated and update details
   * @returns, request path params and request body.
   */
  processInput(payload) {
    const {savedCardId, ...updateCardPayload} = payload;
    console.assert(
      savedCardId !== undefined,
      'updateCreditCard endpoint requires a savedCardId to be specified in the payload.'
    );

    return {
      params: [savedCardId],
      body: updateCardPayload
    };
  },

  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   * @param response the response object
   * @param state, the application state object
   * @returns partial state to be merged with application state
   */
  async processOutput(response, state) {
    const json = await getBodyAsJson(response);

    return response.ok ? transformSavedCardResponse(state, json) : populateError(response, json);
  }
});
