/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {getPage} from '@oracle-cx-commerce/commerce-utils/selector';

export const processInput = (payload, state) => {
  const {siteId = getPage(state).siteId} = payload;

  console.assert(siteId, 'Missing argument "siteId" for endpoint "getSite"');

  return {params: [siteId]};
};

export const processOutput = async response => {
  const json = await getBodyAsJson(response);

  if (response.ok) {
    return {
      siteRepository: {
        sites: {
          [json.id]: json
        }
      }
    };
  }

  return populateError(response, json);
};

export default createEndpoint('getSite', {
  processInput,
  processOutput
});
