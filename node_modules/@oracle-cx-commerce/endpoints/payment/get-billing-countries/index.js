/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {transformBillingCountries} from '@oracle-cx-commerce/endpoints/utils/transform';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';

/**
 * Endpoint adapter for the 'getBillingCountries' action.
 * This maps the action to an 'getBillingCountries' endpoint invocation.
 */

export default createEndpoint('getBillingCountries', {
  processInput(payload) {
    const queryParams = payload;

    const request = {
      query: {
        queryParams
      }
    };

    return Object.keys(queryParams).length === 0 ? {} : request;
  },
  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   */
  async processOutput(response) {
    const json = await getBodyAsJson(response);
    const {items} = json;

    return response.ok ? {...transformBillingCountries(items)} : populateError(response, json);
  }
});
