/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {transformIncompleteOrder} from '@oracle-cx-commerce/endpoints/utils/transform';

export default createEndpoint('getInitialOrder', {
  /**
   * Endpoint adapter for the 'getInitialOrder' action.
   * This maps the action to an 'getInitialOrder' endpoint invocation.
   */
  processInput(payload) {
    const {type, customProperties, ...queryParams} = payload;

    return {
      params: type ? [type] : ['generic'],
      query: Object.keys(queryParams).length === 0 ? {} : queryParams,
      body: {
        customProperties
      }
    };
  },
  /**
   * Convert the response from the endpoint invocation into an object
   * to be merged into the application state.
   */
  async processOutput(response) {
    const json = await getBodyAsJson(response);

    return response.ok ? transformIncompleteOrder(json) : populateError(response, json);
  }
});
