/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {createEndpoint, getBodyAsJson} from '@oracle-cx-commerce/endpoints/factory';
import {populateError} from '@oracle-cx-commerce/endpoints/utils';
import {updatePaymentGroup} from '@oracle-cx-commerce/endpoints/utils/transform';

/**
 * Endpoint adapter for the 'getPaymentGroup' action.
 * This maps the action to 'getPaymentGroup' endpoint invocation.
 */

export default createEndpoint('getPaymentGroup', {
  processInput(payload) {
    const {paymentGroupId, ...queryParams} = payload;
    console.assert(paymentGroupId, 'getPaymentGroup requires a paymentGroupId.');

    return {
      params: [paymentGroupId],
      query: {...queryParams}
    };
  },
  async processOutput(response, state, payload) {
    const json = await getBodyAsJson(response);
    const {orderId} = payload;

    return response.ok ? updatePaymentGroup(state, json, orderId) : populateError(response, json);
  }
});
