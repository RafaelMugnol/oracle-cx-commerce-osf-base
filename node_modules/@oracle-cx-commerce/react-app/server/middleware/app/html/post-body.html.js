/*
 ** Copyright (c) 2021 Oracle and/or its affiliates.
 */

import {getEmptyString} from '@oracle-cx-commerce/utils/generic';
import {getSite} from '@oracle-cx-commerce/commerce-utils/selector';

const {OCC_BUILDER} = process.env;

export default (req, res) => {
  const {state} = res.locals;

  const {body = getEmptyString} = res.app.locals.indexHtml || {};

  const {pageTags: {bodyEnd = []} = {}} = getSite(state);

  let html = `${bodyEnd.join('')}${body(req, res)}`;

  if (OCC_BUILDER) {
    html += '<script src="/reload/reload.js"></script>';
  }

  return html;
};
