/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import React from 'react';
import {noop, t} from '@oracle-cx-commerce/utils/generic';
import Dropdown from '@oracle-cx-commerce/react-components/dropdown';
import Styled from '@oracle-cx-commerce/react-components/styled';
import css from '@oracle-cx-commerce/react-components/pagination/dropdown/styles.css';

const DROPDOWN_DELIMITER = '__DROPDOWN__';

/**
 * A React component to display "drop-down" pagination UI.
 *
 * @param {Object} props Pagination props
 */
const DropdownPagination = props => {
  const {
    currentOffset = 0,
    limit = 16,
    totalRecords = 0,
    onPageChange = noop,
    className = '',
    labelPageOfPagesDropdown = DROPDOWN_DELIMITER,
    labelPaginationDropDown = ''
  } = props;

  const currentPage = Math.ceil(currentOffset / limit) + 1,
    totalPages = Math.ceil(totalRecords / limit);

  const text = t(labelPageOfPagesDropdown, {totalPages});
  const parts = text.split(DROPDOWN_DELIMITER);

  const options = [];
  for (let i = 1; i <= totalPages; i++) {
    options.push(
      <option key={i} value={i}>
        {i}
      </option>
    );
  }

  const handleChange = ev => {
    const pageNumber = ev.target.value;
    const newOffset = (pageNumber - 1) * limit;

    onPageChange(newOffset, pageNumber);
  };

  const dropdown = (
    <Dropdown
      className="DropdownPagination__Dropdown"
      aria-label={labelPaginationDropDown}
      value={currentPage}
      onChange={handleChange}
    >
      {options}
    </Dropdown>
  );

  return (
    <Styled id="DropdownPagination" css={css}>
      <div className={`DropdownPagination ${className}`}>
        {parts[0]}
        {dropdown}
        {parts[1]}
      </div>
    </Styled>
  );
};

export default DropdownPagination;
