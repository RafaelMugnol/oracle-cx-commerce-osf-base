/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {getAssets} from '@oracle-cx-commerce/commerce-utils/selector';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {useEffect} from 'react';
import {fetchAsset} from '@oracle-cx-commerce/fetchers/assets';

/**
 * A useEffect hook to use the fetchAsset fetcher during client-side rendering.
 */
export const useAssetFetcher = (store, {pageId, assetId}) => {
  const assets = getAssets(store.getState());

  return useEffect(() => {
    const asset = assets[assetId];

    if (isEmptyObject(asset)) {
      // Only fetch an asset if it's not already present in the state.
      fetchAsset(store, {pageId});
    }
  }, [pageId, store, assetId, assets]);
};

export default useAssetFetcher;
