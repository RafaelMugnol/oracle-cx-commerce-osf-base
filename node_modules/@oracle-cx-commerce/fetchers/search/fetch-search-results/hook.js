/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {fetchSearchResults} from '@oracle-cx-commerce/fetchers/search';
import {getSearchResults} from '@oracle-cx-commerce/commerce-utils/selector';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {useEffect} from 'react';

/**
 * A useEffect hook to use the fetchSearchResults fetcher during
 * client-side rendering.
 */
export const useSearchResultsFetcher = (store, {contextId, pageId, pageType, searchServicePath}) => {
  return useEffect(() => {
    if (isEmptyObject(getSearchResults(store.getState()))) {
      // Search result not loaded -- fetch them
      fetchSearchResults(store, {searchServicePath});
    } else {
      // Search results already loaded -- update search context to display them
      store.dispatch({type: 'updateState', delta: {clientRepository: {context: {request: {search: pageId}}}}});
    }
  }, [contextId, pageId, pageType, store, searchServicePath]);
};
