/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {endpointSaga, takeLeading} from '@oracle-cx-commerce/store/utils';
import {all, select} from 'redux-saga/effects';
import {getCurrentOrderId} from '@oracle-cx-commerce/commerce-utils/selector';

/**
 * generator function to include currentOrderId if orderId is not part of payload.
 * @param {*} action
 */
function* requestQuoteSaga(action) {
  const state = yield select();
  const requestedOrderId = action.payload.orderId;
  const currentOrderId = getCurrentOrderId(state);
  //putting currentOrderId if orderId is not defined in the payload.
  const orderId = requestedOrderId ? requestedOrderId : currentOrderId;
  action.payload = {...action.payload, orderId};

  return yield endpointSaga({...action, endpointId: 'requestQuote'});
}

export default {
  *saga() {
    yield all([
      takeLeading('requestQuote', requestQuoteSaga),
      takeLeading('rejectQuote', endpointSaga),
      takeLeading('submitQuotedOrder', endpointSaga),
      takeLeading('updateQuotedOrder', endpointSaga)
    ]);
  }
};
