/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import {createReducer} from '@oracle-cx-commerce/store/utils';
import {isEmptyObject} from '@oracle-cx-commerce/utils/generic';
import {updateState} from '@oracle-cx-commerce/utils/store';

/*
  Reducer to save component date into state
 */
function saveComponentDataReducer(state, action) {
  const dataFromComponent = action.payload;
  if (!isEmptyObject(dataFromComponent)) {
    const dataToState = {...dataFromComponent};
    const {clientRepository = {}} = state;
    const {context = {}} = clientRepository;
    const {session = {}} = context;
    const {componentData = {}} = session;

    const componentDataMerged = updateState({componentData}, {componentData: dataToState});

    return {
      ...state,
      clientRepository: {
        ...clientRepository,
        context: {
          ...context,
          session: {
            ...session,
            ...componentDataMerged
          }
        }
      }
    };
  }

  return state;
}

export default {
  reducer: createReducer({saveComponentData: saveComponentDataReducer})
};
