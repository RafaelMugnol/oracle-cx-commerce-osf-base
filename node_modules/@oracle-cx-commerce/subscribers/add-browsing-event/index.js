/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import {getCurrentCatalogId, getPage} from '@oracle-cx-commerce/commerce-utils/selector';

export default ({endpoint, subscribeDispatch}) => {
  return subscribeDispatch((action, state) => {
    const {type} = action;
    if (type === 'getApplicationPageComplete' || type === 'initComplete') {
      const {pageType, contextId} = getPage(state);
      const pageView = {};
      switch (pageType) {
        case 'product':
          pageView.type = 'PRODUCT';
          break;
        case 'category':
        case 'collection':
          pageView.type = 'COLLECTION';
          break;
        default:
      }

      // Only call the endpoint if we have a type. I.e. we're on a product or collection page.
      if (pageView.type) {
        pageView.catalogId = getCurrentCatalogId(state);
        pageView.id = contextId;
        endpoint('addBrowsingEvent', {pageView}, state);
      }
    }
  });
};
