/*
 ** Copyright (c) 2021 Oracle and/or its affiliates.
 */
import {getCurrentProfile, isCurrentUserB2B} from '@oracle-cx-commerce/commerce-utils/selector';

/**
 * For B2B users:
 * Updates currentOrganization cookie with the profile current organization.
 * Updates currencyCode cookie with the selected currency in currencyRepository.
 */
export default ({subscribeDispatch}) => {
  return subscribeDispatch((action, state) => {
    const {endpointId} = action;

    const isB2BUser = isCurrentUserB2B(state);
    if (endpointId === 'getCurrentProfile' && isB2BUser) {
      const {currentOrganization} = getCurrentProfile(state);
      if (currentOrganization) {
        document.cookie = `currentOrganization=${currentOrganization};SameSite=Strict;path=/`;
      }
    }
  });
};
