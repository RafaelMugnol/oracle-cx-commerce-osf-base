/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import {getCurrentProfileId} from '@oracle-cx-commerce/commerce-utils/selector';
import {postToInfinity} from '@oracle-cx-commerce/subscribers/infinity/utils';

export default (action, state) => {
  const {type} = action;
  if (type === 'applyCouponsToCartResolved') {
    const {originalAction} = action;
    const {coupons} = originalAction.payload;
    const inputMap = {};
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    inputMap['wt.dcsvid'] = getCurrentProfileId(state);
    inputMap['wt.mc_id'] = coupons;
    inputMap['wt.cg_n'] = 'Coupon';

    postToInfinity(inputMap);
  }
};
