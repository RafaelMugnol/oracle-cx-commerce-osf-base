/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {getCurrentProfileId} from '@oracle-cx-commerce/commerce-utils/selector';
import {postToInfinity} from '@oracle-cx-commerce/subscribers/infinity/utils';

let logoutInputMap = {};

export default (action, state) => {
  const {type} = action;
  if (type === 'logout') {
    logoutInputMap['wt.dcsvid'] = getCurrentProfileId(state);
    logoutInputMap['wt.cg_n'] = 'User Profile';
    logoutInputMap['wt.si_p'] = 'User Logged Out';
  } else if (type === 'logoutResolved') {
    const inputMap = {...logoutInputMap};
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    logoutInputMap = {};

    postToInfinity(inputMap);
  }
};
