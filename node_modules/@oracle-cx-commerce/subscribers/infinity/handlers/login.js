/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {getCurrentProfileId, getCurrentProfile} from '@oracle-cx-commerce/commerce-utils/selector';
import {postToInfinity} from '@oracle-cx-commerce/subscribers/infinity/utils';

export default (action, state) => {
  const {type} = action;
  if (type === 'loginResolved') {
    const inputMap = {};
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    inputMap['wt.dcsvid'] = getCurrentProfileId(state);
    inputMap['wt.ce'] = getCurrentProfile(state).GDPRProfileP13nConsentGranted ? 1 : 0;
    inputMap['wt.cg_n'] = 'User Profile';
    inputMap['wt.si_p'] = 'Logged In';

    postToInfinity(inputMap);
  } else if (type === 'login') {
    const inputMap = {};
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    inputMap['wt.cg_n'] = 'User Profile';
    inputMap['wt.si_p'] = 'Log In Submit';

    postToInfinity(inputMap);
  }
};
