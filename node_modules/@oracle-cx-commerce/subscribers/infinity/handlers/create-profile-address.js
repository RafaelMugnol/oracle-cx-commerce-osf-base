/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

import {getCurrentProfileId} from '@oracle-cx-commerce/commerce-utils/selector';
import {postToInfinity} from '@oracle-cx-commerce/subscribers/infinity/utils';

export default (action, state) => {
  const {type} = action;
  if (type === 'createProfileAddressResolved') {
    const {originalAction} = action;
    const {city, country, postalCode} = originalAction.payload;
    const inputMap = {};
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    inputMap['wt.dcsvid'] = getCurrentProfileId(state);
    inputMap['wt.z_country'] = country;
    inputMap['wt.z_region'] = originalAction.payload.state;
    inputMap['wt.z_city'] = city;
    inputMap['wt.z_zip'] = postalCode;
    inputMap['wt.cg_n'] = 'Address';

    postToInfinity(inputMap);
  }
};
