/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */
import {
  getCurrentPriceListGroup,
  getCurrentOrder,
  getCurrentProfileId,
  getProduct
} from '@oracle-cx-commerce/commerce-utils/selector';
import {postToInfinity} from '@oracle-cx-commerce/subscribers/infinity/utils';

export default (action, state) => {
  const {type} = action;
  if (type === 'updateCartItemResolved') {
    const {originalAction} = action;
    const {commerceItemId, quantity} = originalAction.payload;
    const {commerceItems} = getCurrentOrder(state);
    const inputMap = {};
    const {brand, type: productType} = getProduct(state, {productId: commerceItems[commerceItemId].productId});
    [inputMap['page-uri']] = encodeURI(window.location).split('?');
    inputMap['wt.dcsvid'] = getCurrentProfileId(state);
    inputMap['wt.pn_id'] = commerceItems[commerceItemId].productId;
    inputMap['wt.pn_sku'] = commerceItems[commerceItemId].catRefId;
    inputMap['wt.tx_u'] = quantity;
    inputMap['wt.tx_s'] = commerceItems[commerceItemId].price;
    inputMap['wt.pn_fa'] = productType;
    inputMap['wt.pn_ma'] = brand;
    inputMap['wt.tx_e'] = 'a';
    inputMap['wt.cg_n'] = 'Cart';
    inputMap['wt.si_p'] = 'Update Cart';
    inputMap['wt.z_currency'] = getCurrentPriceListGroup(state).currency.currencyCode;

    postToInfinity(inputMap);
  }
};
