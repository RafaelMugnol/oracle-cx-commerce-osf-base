/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

const authenticate = require('./authenticate/index');
const browserCapabilities = require('./browser-capabilities');
const fetch = require('./fetch');
const metrics = require('./metrics');
const preview = require('./preview');
const sso = require('./sso');
const obo = require('./obo');
const punchout = require('./punchout');
const statusCheck = require('./status-check');
const requestLogger = require('./request-logger');

module.exports = async (app, middlewares = []) => {
  const appMiddleware = {};

  for (const createMiddleware of middlewares) {
    Object.assign(appMiddleware, await createMiddleware(app));
  }

  return {
    ...requestLogger(app),
    ...appMiddleware,
    ...authenticate(app),
    ...browserCapabilities(app),
    ...fetch(app),
    ...metrics(app),
    ...preview(app),
    ...sso(app),
    ...obo(app),
    ...punchout(app),
    ...statusCheck(app)
  };
};
