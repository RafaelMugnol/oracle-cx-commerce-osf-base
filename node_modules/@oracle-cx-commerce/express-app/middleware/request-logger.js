/*
 ** Copyright (c) 2020 Oracle and/or its affiliates.
 */

const logger = require('@oracle-cx-commerce/logger/server');

/**
 * Create middleware to log debug info about the incoming request.
 *
 * When running locally, using the --verbose cli option will enable this logging. Similarly,
 * setting the env var OCC_VERSBOSE=true will also work.
 *
 * For app servers running on the controllers, use cli 'occ set-logging-options --appLogLevel debug --live' to
 * enable this feature on the live servers. Use 'occ set-logging-options --appLogLevel info --live' to disable
 * it.
 */
module.exports = (/*app*/) => {
  return {
    requestLogger(req, res, next) {
      if (process.env.STOREUI_LOG_LEVEL === 'debug') {
        logger.debug();
        logger.debug('******** OSF INCOMING REQUEST START ************');
        logger.debug(`req.protocol = ${req.protocol}`);
        logger.debug(`req.hostname = ${req.hostname}`);
        logger.debug(`req.url => ${req.url}`);
        logger.debug(`req.originalUrl = ${req.originalUrl}`);
        logger.debug(`req.headers =>\n${JSON.stringify(req.headers, null, 2)}`);
        logger.debug(`res.locals.location = ${res.locals.location}`);
        logger.debug('******** OSF INCOMING REQUEST END   ************');
      }
      next();
    }
  };
};
