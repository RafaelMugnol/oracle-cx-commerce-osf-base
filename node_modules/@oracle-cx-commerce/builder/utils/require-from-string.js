/*
 ** Copyright (c) 2021 Oracle and/or its affiliates.
 */
const Module = require('module');
const path = require('path');

function requireFromString(text, file) {
  const paths = Module._nodeModulePaths(path.dirname(file));

  const {parent} = module;

  const psuedoModule = new Module(file, parent);

  psuedoModule.file = file;

  psuedoModule.paths = [...paths];

  psuedoModule._compile(text, file);

  if (parent && parent.children) {
    parent.children.splice(parent.children.indexOf(psuedoModule), 1);
  }

  return psuedoModule.exports;
}

module.exports = {requireFromString};
